<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>新加坡疫情地图</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <!-- including ECharts file -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <script src="dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=nSxiPohfziUaCuONe4ViUP2N"></script>
    <script src="dist/extension/bmap.min.js"></script>
    <script src="data.js"></script>
</head>
<body>
    <!-- prepare a DOM container with width and height -->
    <div id="main" style="margin:auto;position:absolute;width:100%;height:100%;"></div>
    <script type="text/javascript">
    var chartDom = document.getElementById('main');
    var myChart = echarts.init(chartDom);
    var option;

    var convertData = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var geoCoord = geoCoordMap[data[i].name];
            if (geoCoord) {
                res.push({
                    name: data[i].name,
                    value: geoCoord.concat(data[i].value)
                });
            }
        }
        return res;
    };
var dateFrom = new Date(Date.UTC(2021, 08, 05, 0, 0, 0)).toISOString().slice(0, 10);;//就是这么简单
var date = new Date().toISOString().slice(0, 10);
option = {
    title: {
        text: '新加坡疫情地图',
        subtext: '(' + dateFrom + " - " + date+')',
        left: 'center',
        // backgroundColor: '#FFF'
    },
    tooltip : {
        trigger: 'item'
    },
    bmap: {
        center: [103.81, 1.35339],
        zoom: 12,
        roam: true,
        mapStyle: {style: 'light'}
    },
    series : [
        {
            name: '感染人数',
            type: 'scatter',
            coordinateSystem: 'bmap',
            data: convertData(data),
            encode: {
                value: 2
            },
            symbolSize: function (val) {
                return Math.log(val[2]+5)*6;
            },
            label: {
                formatter: '{b}',
                position: 'right',
                color:'#FF0000'
            },
            itemStyle: {
                color: '#FF0000'
            },
            emphasis: {
                label: {
                    show: true
                }
            }
        },
        {
            name: 'Top 10',
            type: 'effectScatter',
            coordinateSystem: 'bmap',
            data: convertData(data.sort(function (a, b) {
                return b.value - a.value;
            }).slice(0, 10)),
            symbolSize: function (val) {
                return Math.log(val[2]+5)*3;
            },
            encode: {
                value: 2
            },
            showEffectOn: 'render',
            rippleEffect: {
                brushType: 'stroke'
            },
            hoverAnimation: false,
            label: {
                formatter: '{b}',
                position: 'right',
                show: false,
                color: '#FF0000'
            },
            itemStyle: {
                shadowBlur: 20,
                shadowColor: '#FF0000'
            },
            zlevel: 1
        }
    ]
};

option && myChart.setOption(option);
    </script>
</body>
</html>
